from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time
import pickle

option = webdriver.ChromeOptions()
option.add_experimental_option("detach",True)

# Ganti dengan path ke direktori profil pengguna Chrome Anda
option.add_argument("--user-data-dir=<path-to-your-chrome-user-data>")


driver = webdriver.Chrome(options=option, service=Service(ChromeDriverManager().install()))


driver.get("https://web.whatsapp.com/")

# Load cookies
try:
    cookies = pickle.load(open("cookies.pkl", "rb"))
    for cookie in cookies:
        driver.add_cookie(cookie)
    # Refresh the page after adding cookies
    driver.refresh()
except (OSError, IOError) as e:
    print("No cookie file found")

# Save cookies
with open("cookies.pkl", "wb") as file:
    pickle.dump(driver.get_cookies(), file)



while True:
    try:
        notif_path = '.x1rg5ohu.x173ssrc.x1xaadd7.x682dto.x1e01kqd.x12j7j87.x9bpaai.x1pg5gke.x1s688f.xo5v014.x1u28eo4.x2b8uid.x16dsc37.x18ba5f9.x1sbl2l.xy9co9w.x5r174s.x7h3shv'
        notif = WebDriverWait(driver,60).until(EC.presence_of_element_located((By.CSS_SELECTOR, notif_path)))

        notif.click()
        time.sleep(10)

        message_path = '//*[@id="main"]/footer/div[1]/div/span[2]/div/div[2]/div[1]/div/div[1]/p'
        message_box = WebDriverWait(driver,60).until(EC.presence_of_element_located((By.XPATH, message_path)))
        message_box.send_keys('Pesan kamu disini')
        message_box.send_keys(Keys.RETURN)

        time.sleep(30)
    except Exception as e:
        print(f"Terjadi kesalahan: {e}")
        time.sleep(60) 






   







